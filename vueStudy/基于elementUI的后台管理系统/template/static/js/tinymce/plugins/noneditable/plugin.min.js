tinymce.PluginManager.add("noneditable",function(e){function t(e){var t;if(1===e.nodeType){if(t=e.getAttribute(u),t&&"inherit"!==t)return t;if(t=e.contentEditable,"inherit"!==t)return t}return null}function n(e){for(var n;e;){if(n=t(e))return"false"===n?e:null;e=e.parentNode}}function r(){function r(e){for(;e;){if(e.id===h)return e;e=e.parentNode}}function i(e){var t;if(e)for(t=new l(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function o(n,r){var i,o;return"false"===t(n)&&u.isBlock(n)?void f.select(n):(o=u.createRng(),"true"===t(n)&&(n.firstChild||n.appendChild(e.getDoc().createTextNode("\xa0")),n=n.firstChild,r=!0),i=u.create("span",{id:h,"data-mce-bogus":!0},p),r?n.parentNode.insertBefore(i,n):u.insertAfter(i,n),o.setStart(i.firstChild,1),o.collapse(!0),f.setRng(o),i)}function a(e){var t,n,r;if(e)t=f.getRng(!0),t.setStartBefore(e),t.setEndBefore(e),n=i(e),n&&n.nodeValue.charAt(0)==p&&(n=n.deleteData(0,1)),u.remove(e,!0),f.setRng(t);else for(;(e=u.get(h))&&e!==r;)n=i(e),n&&n.nodeValue.charAt(0)==p&&(n=n.deleteData(0,1)),u.remove(e,!0),r=e}function s(){function e(e,n){var r,i,o,a,s;if(r=c.startContainer,i=c.startOffset,3==r.nodeType){if(s=r.nodeValue.length,i>0&&s>i||(n?i==s:0===i))return}else{if(!(i<r.childNodes.length))return n?null:e;var u=!n&&i>0?i-1:i;r=r.childNodes[u],r.hasChildNodes()&&(r=r.firstChild)}for(o=new l(r,e);a=o[n?"prev":"next"]();){if(3===a.nodeType&&a.nodeValue.length>0)return;if("true"===t(a))return a}return e}var r,i,s,c,u;a(),s=f.isCollapsed(),r=n(f.getStart()),i=n(f.getEnd()),(r||i)&&(c=f.getRng(!0),s?(r=r||i,(u=e(r,!0))?o(u,!0):(u=e(r,!1))?o(u,!1):f.select(r)):(c=f.getRng(!0),r&&c.setStartBefore(r),i&&c.setEndAfter(i),f.setRng(c)))}function c(i){function o(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function c(e,t){f.select(e),f.collapse(t)}function h(i){function o(e){for(var t=c;t;){if(t===e)return;t=t.parentNode}u.remove(e),s()}function a(){var r,a,s=e.schema.getNonEmptyElements();for(a=new tinymce.dom.TreeWalker(c,e.getBody());(r=i?a.prev():a.next())&&!s[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===t(r))return o(r),!0;return n(r)?!0:!1}var l,c,d,h;if(f.isCollapsed()){if(l=f.getRng(!0),c=l.startContainer,d=l.startOffset,c=r(c)||c,h=n(c))return o(h),!1;if(3==c.nodeType&&(i?d>0:d<c.nodeValue.length))return!0;if(1==c.nodeType&&(c=c.childNodes[d]||c),a())return!1}return!0}var p,m,g,v,y=i.keyCode;s(),g=f.getStart(),v=f.getEnd(),p=n(g)||n(v);var b=e.selection.getNode(),x=y==d.LEFT||y==d.RIGHT||y==d.UP||y==d.DOWN,C=y==d.LEFT||y==d.UP;if(p&&(112>y||y>124)&&y!=d.DELETE&&y!=d.BACKSPACE){if((tinymce.isMac?i.metaKey:i.ctrlKey)&&(67==y||88==y||86==y))return;if(i.preventDefault(),x)if(e.dom.isBlock(p)){var w=C?p.previousSibling:p.nextSibling;if(!w||w&&"false"===t(w)){var _=u.create("p",null,"&nbsp;");_.className="mceTmpParagraph";var N=C?p:w;N&&N.parentNode?N.parentNode.insertBefore(_,N):w||C||p.parentNode.appendChild(_),w=_}var k=new l(w,w),E=C?k.prev():k.next();c(E,!C)}else c(p,C)}else if(x||y==d.BACKSPACE||y==d.DELETE){if(m=r(g)){if(y==d.LEFT||y==d.BACKSPACE)if(p=o(m,!0),p&&"false"===t(p)){if(i.preventDefault(),y!=d.LEFT)return void u.remove(p);c(p,!0)}else a(m);if(y==d.RIGHT||y==d.DELETE)if(p=o(m,!0),p&&"false"===t(p)){if(i.preventDefault(),y!=d.RIGHT)return void u.remove(p);c(p,!1)}else a(m)}else{if(x&&b&&-1!==b.className.indexOf("mceTmpParagraph")&&b[C?"previousSibling":"nextSibling"]){var S=b[C?"previousSibling":"nextSibling"];"&nbsp;"===b.innerHTML||""===b.innerHTML||" "===b.innerHTML?u.remove(b):b.className=b.className.replace("mceTmpParagraph",""),c(S,!C)}var T=f.getRng(!0),R=T.endContainer;if(u.isBlock(R)&&u.isBlock(R.nextSibling)&&1==T.endOffset&&y==d.DELETE&&(p=n(R.nextSibling)),p&&(y==d.DELETE||y==d.BACKSPACE)&&u.isBlock(p))return i.preventDefault(),void u.remove(p)}if((y==d.BACKSPACE||y==d.DELETE)&&!h(y==d.BACKSPACE))return i.preventDefault(),!1}}var u=e.dom,f=e.selection,h="mce_noneditablecaret",p="\ufeff";e.on("mousedown",function(n){var r=e.selection.getNode();r&&-1!==r.className.indexOf("mceTmpParagraph")&&r!==n.target&&("&nbsp;"===r.innerHTML||""===r.innerHTML||" "===r.innerHTML?u.remove(r):r.className=r.className.replace("mceTmpParagraph","")),"false"===t(r)&&r==n.target&&s()}),e.on("mouseup",s),e.on("keydown",c)}function i(t){var n=s.length,r=t.content,i=tinymce.trim(a);if("raw"!=t.format){for(;n--;)r=r.replace(s[n],function(t){var n=arguments,o=n[n.length-2];return o>0&&'"'==r.charAt(o-1)?t:'<span class="'+i+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var o,a,s,l=tinymce.dom.TreeWalker,c="contenteditable",u="data-mce-"+c,d=tinymce.util.VK;o=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",a=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",s=e.getParam("noneditable_regexp"),s&&!s.length&&(s=[s]),e.on("PreInit",function(){r(),s&&e.on("BeforeSetContent",i),e.parser.addAttributeFilter("class",function(e){for(var t,n,r=e.length;r--;)n=e[r],t=" "+n.attr("class")+" ",-1!==t.indexOf(o)?n.attr(u,"true"):-1!==t.indexOf(a)&&n.attr(u,"false")}),e.serializer.addAttributeFilter(u,function(e){for(var t,n=e.length;n--;)t=e[n],s&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(c,null),t.attr(u,null))}),e.parser.addAttributeFilter(c,function(e){for(var t,n=e.length;n--;)t=e[n],t.attr(u,t.attr(c)),t.attr(c,null)})}),e.on("drop",function(e){n(e.target)&&e.preventDefault()})});